<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Solar System + Milky Way</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="data:,">
<style>
html,body{margin:0;height:100%;background:#000;overflow:hidden}
#ui{
  position:fixed;top:14px;left:14px;z-index:10;
  color:#fff;font-family:system-ui;
  background:rgba(0,0,0,.45);
  padding:10px;border-radius:8px;
}
canvas{display:block}
</style>
</head>
<body>

<div id="ui">Solar System + Milky Way loaded</div>

<!-- Hipparcos star data (GLOBAL) -->
<script src="./hipparcos_6.5_concise.js"></script>

<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.164.1/build/three.module.js"
  }
}
</script>

<script type="module">
import * as THREE from "three";
import { OrbitControls } from "https://cdn.jsdelivr.net/npm/three@0.164.1/examples/jsm/controls/OrbitControls.js";

/* ================= BASIC ================= */
const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(Math.min(devicePixelRatio,2));
document.body.appendChild(renderer.domElement);

const scene = new THREE.Scene();
scene.background = new THREE.Color(0x000010);

const camera = new THREE.PerspectiveCamera(55, innerWidth/innerHeight, 0.1, 5000);
camera.position.set(0, 30, 160);
camera.lookAt(0,0,0);

const controls = new OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;

scene.add(new THREE.AmbientLight(0x333333, 1));

/* ================= HELPERS ================= */
function raDecToVec3(raDeg, decDeg, r=1200){
  const ra = THREE.MathUtils.degToRad(raDeg);
  const dec = THREE.MathUtils.degToRad(decDeg);
  return new THREE.Vector3(
    r*Math.cos(dec)*Math.cos(ra),
    r*Math.sin(dec),
    r*Math.cos(dec)*Math.sin(ra)
  );
}

/* ================================================= */
/* ================= SOLAR SYSTEM ================= */
/* ================================================= */

const solarSystem = new THREE.Group();
scene.add(solarSystem);

const tl = new THREE.TextureLoader();
const T = {
  sun: tl.load("https://diwakarasd.github.io/galaxy-textures/2k_sun.jpg"),
  mercury: tl.load("https://diwakarasd.github.io/galaxy-textures/2k_mercury.jpg"),
  venus: tl.load("https://diwakarasd.github.io/galaxy-textures/2k_venus_surface.jpg"),
  earth: tl.load("https://diwakarasd.github.io/galaxy-textures/2k_earth_daymap.jpg"),
  mars: tl.load("https://diwakarasd.github.io/galaxy-textures/2k_mars.jpg"),
  jupiter: tl.load("https://diwakarasd.github.io/galaxy-textures/2k_jupiter.jpg"),
  saturn: tl.load("https://diwakarasd.github.io/galaxy-textures/2k_saturn.jpg"),
  saturnRing: tl.load("https://diwakarasd.github.io/galaxy-textures/2k_saturn_ring_alpha.png")
};

/* Sun */
const sun = new THREE.Mesh(
  new THREE.SphereGeometry(12,48,32),
  new THREE.MeshBasicMaterial({ map: T.sun })
);
solarSystem.add(sun);

solarSystem.add(new THREE.PointLight(0xffffff, 3, 600));

/* Planet factory */
function createPlanet(size, dist, speed, texture, ring=false){
  const pivot = new THREE.Object3D();
  solarSystem.add(pivot);

  const planet = new THREE.Mesh(
    new THREE.SphereGeometry(size,32,32),
    new THREE.MeshStandardMaterial({ map: texture })
  );
  planet.position.x = dist;
  pivot.add(planet);

  if(ring){
    const ringMesh = new THREE.Mesh(
      new THREE.RingGeometry(size*1.4, size*2.4, 64),
      new THREE.MeshBasicMaterial({
        map: T.saturnRing,
        transparent:true,
        side:THREE.DoubleSide,
        depthWrite:false
      })
    );
    ringMesh.rotation.x = Math.PI/2;
    planet.add(ringMesh);
  }

  return { pivot, speed };
}

/* Planets */
const planets = [
  createPlanet(1, 18, 0.02, T.mercury),
  createPlanet(2, 26, 0.015, T.venus),
  createPlanet(2.2, 34, 0.01, T.earth),
  createPlanet(1.8, 42, 0.008, T.mars),
  createPlanet(5, 58, 0.004, T.jupiter),
  createPlanet(4.5, 76, 0.003, T.saturn, true)
];

/* ================================================= */
/* ================= MILKY WAY STARS =============== */
/* ================================================= */

const galaxyRoot = new THREE.Group();
scene.add(galaxyRoot);

function loadStars(){
  if(!window.hipparcos_6_5) return;

  const pos=[], col=[];
  hipparcos_6_5.forEach(s=>{
    const v = raDecToVec3(s.RAdeg, s.DEdeg);
    pos.push(v.x,v.y,v.z);

    const b = Math.max(0.3, 1.6 - s.Vmag*0.3);
    col.push(b,b,b);
  });

  const g = new THREE.BufferGeometry();
  g.setAttribute("position", new THREE.Float32BufferAttribute(pos,3));
  g.setAttribute("color", new THREE.Float32BufferAttribute(col,3));

  galaxyRoot.add(new THREE.Points(
    g,
    new THREE.PointsMaterial({
      size:1.4,
      vertexColors:true,
      depthWrite:false
    })
  ));
}

/* Load stars after first render */
setTimeout(loadStars, 100);

/* ================= ANIMATE ================= */
function animate(){
  requestAnimationFrame(animate);

  planets.forEach(p=>p.pivot.rotation.y += p.speed);

  controls.update();
  renderer.render(scene,camera);
}
animate();

addEventListener("resize", ()=>{
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
});
</script>

</body>
</html>
