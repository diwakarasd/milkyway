<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Solar System inside 3D Milky Way</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="data:,">
<style>
html,body{margin:0;height:100%;background:#000;overflow:hidden}
#ui{
  position:fixed;left:16px;top:16px;z-index:20;
  background:rgba(255,255,255,0.06);
  color:#fff;padding:12px;border-radius:10px;
  font-family:system-ui;font-size:13px;
}
canvas{display:block}
</style>
</head>
<body>

<div id="ui">
<b>Milky Way (Visual)</b><br>
✋ Pinch = Zoom<br>
✋ Move palm = Rotate
</div>

<video id="cam" autoplay playsinline style="display:none"></video>

<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.164.1/build/three.module.js"
  }
}
</script>

<script type="module">
import * as THREE from "three";
import { OrbitControls } from
"https://cdn.jsdelivr.net/npm/three@0.164.1/examples/jsm/controls/OrbitControls.js";

/* ================= BASIC ================= */
const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
renderer.setPixelRatio(Math.min(devicePixelRatio,2));
document.body.appendChild(renderer.domElement);

const scene=new THREE.Scene();
scene.background=new THREE.Color(0x000004);

const camera=new THREE.PerspectiveCamera(50,innerWidth/innerHeight,0.1,5000);
camera.position.set(0,40,160);

const controls=new OrbitControls(camera,renderer.domElement);
controls.enableDamping=true;
controls.minDistance=20;
controls.maxDistance=800;

scene.add(new THREE.AmbientLight(0x202533,0.6));

/* ================= ROOT ================= */
const galaxyRoot=new THREE.Group();
scene.add(galaxyRoot);

/* ================= TEXTURES ================= */
const tl=new THREE.TextureLoader();
const T={
  sun:tl.load("https://diwakarasd.github.io/galaxy-textures/2k_sun.jpg"),
  mercury:tl.load("https://diwakarasd.github.io/galaxy-textures/2k_mercury.jpg"),
  venus:tl.load("https://diwakarasd.github.io/galaxy-textures/2k_venus_surface.jpg"),
  earth:tl.load("https://diwakarasd.github.io/galaxy-textures/2k_earth_daymap.jpg"),
  mars:tl.load("https://diwakarasd.github.io/galaxy-textures/2k_mars.jpg"),
  jupiter:tl.load("https://diwakarasd.github.io/galaxy-textures/2k_jupiter.jpg"),
  saturn:tl.load("https://diwakarasd.github.io/galaxy-textures/2k_saturn.jpg"),
  saturnRing:tl.load("https://diwakarasd.github.io/galaxy-textures/2k_saturn_ring_alpha.png"),
  star:tl.load("https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/sprites/disc.png")
};

/* ================= SUN ================= */
const sun=new THREE.Mesh(
  new THREE.SphereGeometry(12,48,32),
  new THREE.MeshBasicMaterial({map:T.sun,color:0xfff2d0})
);
galaxyRoot.add(sun);

const sunLight=new THREE.PointLight(0xfff1c6,2.8,2000,2);
galaxyRoot.add(sunLight);

const sunGlow=new THREE.Sprite(
  new THREE.SpriteMaterial({
    map:tl.load("https://threejs.org/examples/textures/lensflare/lensflare0.png"),
    color:0xfff2c8,
    transparent:true,
    blending:THREE.AdditiveBlending,
    opacity:0.6
  })
);
sunGlow.scale.set(120,120,1);
galaxyRoot.add(sunGlow);

/* ================= PLANETS ================= */
function createPlanet(size,dist,speed,tex,ring=false){
  const holder=new THREE.Object3D();
  galaxyRoot.add(holder);

  const mesh=new THREE.Mesh(
    new THREE.SphereGeometry(size,48,32),
    new THREE.MeshBasicMaterial({map:tex})
  );
  holder.add(mesh);

  if(ring){
    const r=new THREE.Mesh(
      new THREE.RingGeometry(size*1.3,size*2.4,64),
      new THREE.MeshBasicMaterial({
        map:T.saturnRing,
        transparent:true,
        side:THREE.DoubleSide,
        depthWrite:false
      })
    );
    r.rotation.x=Math.PI/2-0.3;
    mesh.add(r);               // ✅ ring moves with planet
  }

  return {holder,mesh,dist,speed,angle:Math.random()*Math.PI*2};
}

const planets=[
  createPlanet(1,20,0.018,T.mercury),
  createPlanet(2.3,30,0.012,T.venus),
  createPlanet(2.5,40,0.01,T.earth),
  createPlanet(1.4,50,0.008,T.mars),
  createPlanet(6,70,0.004,T.jupiter),
  createPlanet(5.5,95,0.003,T.saturn,true)
];

/* ================= ASTEROID BELT ================= */
function createAsteroidBelt(){
  const count=1800,inner=55,outer=68;
  const pos=new Float32Array(count*3);

  for(let i=0;i<count;i++){
    const a=Math.random()*Math.PI*2;
    const r=inner+Math.random()*(outer-inner);
    pos[i*3]=Math.cos(a)*r;
    pos[i*3+1]=(Math.random()-0.5)*1.2;
    pos[i*3+2]=Math.sin(a)*r;
  }

  const g=new THREE.BufferGeometry();
  g.setAttribute("position",new THREE.BufferAttribute(pos,3));

  const belt=new THREE.Points(
    g,
    new THREE.PointsMaterial({
      size:0.08,color:0x9b8f7f,
      transparent:true,opacity:0.9,depthWrite:false
    })
  );
  galaxyRoot.add(belt);
  return belt;
}
const asteroidBelt=createAsteroidBelt();

/* ================= MILKY WAY (3D) ================= */
function createMilkyWay(){
  const count=16000;
  const pos=new Float32Array(count*3);
  const col=new Float32Array(count*3);

  for(let i=0;i<count;i++){
    const r=Math.pow(Math.random(),0.7)*900;
    const a=Math.random()*Math.PI*2;
    const disk=Math.random()<0.85;
    const y=disk
      ? (Math.random()-0.5)*12*Math.exp(-r/400)
      : (Math.random()-0.5)*120;

    pos[i*3]=Math.cos(a)*r;
    pos[i*3+1]=y;
    pos[i*3+2]=Math.sin(a)*r;

    const c=0.7+Math.random()*0.3;
    col[i*3]=c;
    col[i*3+1]=c*0.9;
    col[i*3+2]=c*0.7;
  }

  const g=new THREE.BufferGeometry();
  g.setAttribute("position",new THREE.BufferAttribute(pos,3));
  g.setAttribute("color",new THREE.BufferAttribute(col,3));

  galaxyRoot.add(new THREE.Points(
    g,
    new THREE.PointsMaterial({
      size:0.9,vertexColors:true,
      transparent:true,blending:THREE.AdditiveBlending,
      depthWrite:false
    })
  ));
}
createMilkyWay();

/* ================= HAND GESTURES (SAFE) ================= */
let smoothScale=1,smoothRx=0,smoothRy=0;
const lowMemory=navigator.deviceMemory && navigator.deviceMemory<=4;

function initHands(){
  if(lowMemory) return console.warn("Low memory – gestures disabled");
  if(typeof Hands==="undefined"||typeof Camera==="undefined"){
    setTimeout(initHands,150); return;
  }

  const video=document.getElementById("cam");
  const hands=new Hands({
    locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`
  });

  hands.setOptions({
    maxNumHands:1,
    modelComplexity:1,
    minDetectionConfidence:0.65,
    minTrackingConfidence:0.65
  });

  hands.onResults(r=>{
    if(!r.multiHandLandmarks) return;
    const lm=r.multiHandLandmarks[0];
    const d=Math.hypot(lm[4].x-lm[8].x,lm[4].y-lm[8].y);
    smoothScale+=(THREE.MathUtils.clamp(0.6+d*6,0.5,3.2)-smoothScale)*0.12;
    const px=(lm[5].x+lm[17].x)/2-0.5;
    const py=(lm[5].y+lm[17].y)/2-0.5;
    smoothRy+=(px*6-smoothRy)*0.12;
    smoothRx+=(py*4.5-smoothRx)*0.12;
  });

  new Camera(video,{
    onFrame:async()=>hands.send({image:video}),
    width:640,height:480
  }).start();
}
initHands();

/* ================= ANIMATE ================= */
function animate(){
  requestAnimationFrame(animate);

  planets.forEach(p=>{
    p.angle+=p.speed;
    p.mesh.position.set(
      Math.cos(p.angle)*p.dist,
      Math.sin(p.angle*0.01)*0.8,
      Math.sin(p.angle)*p.dist
    );
  });

  asteroidBelt.rotation.y+=0.0004;

  galaxyRoot.scale.lerp(
    new THREE.Vector3(smoothScale,smoothScale,smoothScale),0.08
  );
  galaxyRoot.rotation.x+=(smoothRx-galaxyRoot.rotation.x)*0.06;
  galaxyRoot.rotation.y+=(smoothRy-galaxyRoot.rotation.y)*0.06;

  controls.update();
  renderer.render(scene,camera);
}
animate();

addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

</body>
</html>
